// https://github.com/joshua-gould/OpenSeadragonCanvasOverlayHd v1.0.0 Copyright 2018 Joshua Gould
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t.OpenSeadragon=t.OpenSeadragon||{},t.OpenSeadragon.CanvasOverlayHd=e())}(this,function(){"use strict";return class{constructor(t,e){this._viewer=t,this.backingScale=1,this._containerWidth=0,this._containerHeight=0,this._canvasdiv=document.createElement("div"),this._canvasdiv.style.position="absolute",this._canvasdiv.style.left=0,this._canvasdiv.style.top=0,this._canvasdiv.style.width="100%",this._canvasdiv.style.height="100%",this._viewer.canvas.appendChild(this._canvasdiv),this._canvas=document.createElement("canvas"),this._canvasdiv.appendChild(this._canvas),this.onRedraw=e.onRedraw||function(){},this.clearBeforeRedraw=void 0===e.clearBeforeRedraw||e.clearBeforeRedraw,this._viewer.addHandler("update-viewport",()=>{this.resize(),this._updateCanvas()}),this._viewer.addHandler("open",()=>{this.resize(),this._updateCanvas()})}canvas(){return this._canvas}context2d(){return this._canvas.getContext("2d")}clear(){this._canvas.getContext("2d").clearRect(0,0,this._containerWidth*this.backingScale,this._containerHeight*this.backingScale)}resize(){let t=1;"undefined"!=typeof window&&"devicePixelRatio"in window&&window.devicePixelRatio>1&&(t=window.devicePixelRatio);let e=this.backingScale!==t;this.backingScale=t,(this._containerWidth!==this._viewer.container.clientWidth||e)&&(this._containerWidth=this._viewer.container.clientWidth,this._canvasdiv.setAttribute("width",t*this._containerWidth),this._canvas.setAttribute("width",t*this._containerWidth),this._canvas.style.width=this._containerWidth+"px"),(this._containerHeight!==this._viewer.container.clientHeight||e)&&(this._containerHeight=this._viewer.container.clientHeight,this._canvasdiv.setAttribute("height",t*this._containerHeight),this._canvas.setAttribute("height",t*this._containerHeight),this._canvas.style.height=this._containerHeight+"px")}_updateCanvas(){let t=this._viewer.viewport.getZoom(!0);this.clearBeforeRedraw&&this.clear();let e=this._canvas.getContext("2d");for(let n=0,s=this._viewer.world.getItemCount();n<s;n++){let s=this._viewer.world.getItemAt(n);if(s){let h=s.viewportToImageZoom(t);var i=s.imageToViewportCoordinates(0,0,!0),a=this._viewer.viewport.pixelFromPoint(i,!0);e.scale(this.backingScale,this.backingScale),e.translate(a.x,a.y),e.scale(h,h),this.onRedraw({index:n,context:e,x:a.x,y:a.y,zoom:h}),e.setTransform(1,0,0,1,0,0)}}}}});
