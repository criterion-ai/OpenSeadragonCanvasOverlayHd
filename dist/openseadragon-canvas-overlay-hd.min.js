// https://github.com/joshua-gould/OpenSeadragonCanvasOverlayHd v1.0.0 Copyright 2018 Joshua Gould
!function(i,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(i.OpenSeadragon=i.OpenSeadragon||{},i.OpenSeadragon.CanvasOverlayHd=t())}(this,function(){"use strict";return class{constructor(i,t){let e=this;this._viewer=i,this.backingScale=1,this._containerWidth=0,this._containerHeight=0,this._canvasdiv=document.createElement("div"),this._canvasdiv.style.position="absolute",this._canvasdiv.style.left=0,this._canvasdiv.style.top=0,this._canvasdiv.style.width="100%",this._canvasdiv.style.height="100%",this._viewer.canvas.appendChild(this._canvasdiv),this._canvas=document.createElement("canvas"),this._canvasdiv.appendChild(this._canvas),this.onRedraw=t.onRedraw||function(){},this.clearBeforeRedraw=void 0===t.clearBeforeRedraw||t.clearBeforeRedraw,this._viewer.addHandler("update-viewport",function(){e.resize(),e._updateCanvas()}),this._viewer.addHandler("open",function(){e.resize(),e._updateCanvas()})}canvas(){return this._canvas}context2d(){return this._canvas.getContext("2d")}clear(){this._canvas.getContext("2d").clearRect(0,0,this._containerWidth*this.backingScale,this._containerHeight*this.backingScale)}resize(){let i=1;"undefined"!=typeof window&&"devicePixelRatio"in window&&window.devicePixelRatio>1&&(i=window.devicePixelRatio);let t=this.backingScale!==i;this.backingScale=i,(this._containerWidth!==this._viewer.container.clientWidth||t)&&(this._containerWidth=this._viewer.container.clientWidth,this._canvasdiv.setAttribute("width",i*this._containerWidth),this._canvas.setAttribute("width",i*this._containerWidth),this._canvas.style.width=this._containerWidth+"px"),(this._containerHeight!==this._viewer.container.clientHeight||t)&&(this._containerHeight=this._viewer.container.clientHeight,this._canvasdiv.setAttribute("height",i*this._containerHeight),this._canvas.setAttribute("height",i*this._containerHeight),this._canvas.style.height=this._containerHeight+"px"),this._viewportOrigin={x:0,y:0};let e=this._viewer.viewport.getBounds(!0);this._viewportOrigin.x=e.x,this._viewportOrigin.y=e.y*this.imgAspectRatio,this._viewportWidth=e.width,this._viewportHeight=e.height*this.imgAspectRatio;let s=this._viewer.world.getItemAt(0);this.imgWidth=s.source.dimensions.x,this.imgHeight=s.source.dimensions.y,this.imgAspectRatio=this.imgWidth/this.imgHeight}_updateCanvas(){let i=this._viewer.viewport.getZoom(!0),t=this._viewer.world.getItemAt(0);if(t){let e=t.viewportToImageZoom(i),s=(this._viewportOrigin.x/this.imgWidth-this._viewportOrigin.x)/this._viewportWidth*(this.backingScale*this._containerWidth),n=(this._viewportOrigin.y/this.imgHeight-this._viewportOrigin.y)/this._viewportHeight*(this.backingScale*this._containerHeight);this.clearBeforeRedraw&&this.clear();let a=this._canvas.getContext("2d");a.translate(s,n),a.scale(e,e),a.scale(this.backingScale,this.backingScale),this.onRedraw({context:a,x:s,y:n,zoom:e}),a.setTransform(1,0,0,1,0,0)}}}});
